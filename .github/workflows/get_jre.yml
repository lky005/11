name: Get JRE for OpenHarmony

on: [push]

jobs:
  get_jre:
    runs-on: ubuntu-latest
    steps:
    - name: Download BellSoft Liberica JDK 17 (Musl/Alpine version)
      run: |
        echo "正在下载最适配鸿蒙底层(Musl)的工业级 Java..."
        wget -q https://download.bell-sw.com/java/17.0.10+13/bellsoft-jdk17.0.10+13-linux-aarch64-musl.tar.gz
        
        echo "解压中..."
        tar -xzf bellsoft-jdk17.0.10+13-linux-aarch64-musl.tar.gz
        
        # --- 核心修复：智能查找并重命名文件夹 ---
        # 不再硬编码文件夹名，而是查找当前目录下名字以 jdk 开头的文件夹
        EXTRACTED_DIR=$(find . -maxdepth 1 -type d -name "jdk-*" | head -n 1)
        echo "发现解压目录: $EXTRACTED_DIR"
        mv "$EXTRACTED_DIR" ohos_jre
        # ------------------------------------
        
        # 瘦身：移除不必要文件，减小体积
        echo "正在为移动端瘦身..."
        rm -rf ohos_jre/lib/src.zip
        rm -rf ohos_jre/demo
        rm -rf ohos_jre/man
        rm -rf ohos_jre/sample
        rm -rf ohos_jre/include
        rm -rf ohos_jre/jmods
        
        echo "验证 libjvm.so 是否存在..."
        ls -lh ohos_jre/lib/server/libjvm.so

    - name: Upload JRE
      uses: actions/upload-artifact@v4
      with:
        name: OpenHarmony-JRE-17
        path: ohos_jre/
